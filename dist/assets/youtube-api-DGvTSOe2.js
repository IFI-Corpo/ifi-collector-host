let c=localStorage.getItem("YOUTUBE_API_KEY")||"AIzaSyAeAfT6USQFiWCgNOazeBiPl3IabD27l2k",m=localStorage.getItem("GEMINI_API_KEY")||"AIzaSyDMm6SM7x9zKkxV_5WdpwG-wJRusN7xm0E",A=localStorage.getItem("INSTAGRAM_API_KEY")||"",w=localStorage.getItem("TWITTER_API_KEY")||"";const D=e=>{c=e,localStorage.setItem("YOUTUBE_API_KEY",e)},P=e=>{m=e,localStorage.setItem("GEMINI_API_KEY",e)},v=e=>{A=e,localStorage.setItem("INSTAGRAM_API_KEY",e)},K=e=>{w=e,localStorage.setItem("TWITTER_API_KEY",e)},k=()=>c,N=()=>m,R=()=>A,M=()=>w,p=e=>{if(!e)return"N/A";const t=typeof e=="string"?parseInt(e):e;return isNaN(t)?"N/A":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toLocaleString()},_=e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(e),T=e=>{const t=new Date;switch(e){case"یک ساعت گذشته":t.setHours(t.getHours()-1);break;case"امروز":t.setHours(0,0,0,0);break;case"این هفته":const a=t.getDay();t.setDate(t.getDate()-a),t.setHours(0,0,0,0);break;case"این ماه":t.setDate(1),t.setHours(0,0,0,0);break;case"امسال":t.setFullYear(new Date().getFullYear()),t.setMonth(0,1),t.setHours(0,0,0,0);break;default:return""}return t.toISOString()},E=e=>{const t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!t)return 0;const a=parseInt(t[1]||"0",10),r=parseInt(t[2]||"0",10),o=parseInt(t[3]||"0",10);return a*3600+r*60+o},$=async e=>{var t,a,r,o,u;try{return((u=(o=(r=(a=(t=(await(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${m}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Provide a concise summary of this YouTube video: ${e}`}]}]})})).json()).candidates)==null?void 0:t[0])==null?void 0:a.content)==null?void 0:r.parts)==null?void 0:o[0])==null?void 0:u.text)||"No summary available."}catch(i){return console.error("Gemini API error:",i),"Error generating summary."}},G=async(e,t=10,a={})=>{var r;try{const o=new URLSearchParams({part:"snippet",maxResults:t.toString(),q:e,key:c});if(a.type==="کانال"?o.set("type","channel"):o.set("type","video"),a.sortBy)switch(a.sortBy){case"تعداد بازدید":o.set("order","viewCount");break;case"تعداد نظرات":o.set("order","relevance");break;case"تعداد لایک‌ها":o.set("order","relevance");break;default:o.set("order","relevance")}if(a.uploadDate){const s=T(a.uploadDate);s&&o.set("publishedAfter",s)}const i=await(await fetch(`https://www.googleapis.com/youtube/v3/search?${o}`)).json();if(!((r=i.items)!=null&&r.length))return[];const I=i.items.map(s=>s.id?a.type==="کانال"?s.id.channelId:s.id.videoId:null).filter(s=>s!==null),S=await(await fetch(`https://www.googleapis.com/youtube/v3/${a.type==="کانال"?"channels":"videos"}?part=snippet,statistics${a.type!=="کانال"?",contentDetails":""}&id=${I.join(",")}&key=${c}`)).json(),l=i.items.map(s=>{var y,h;if(!s.id)return null;const n=S.items.find(f=>f.id===(a.type==="کانال"?s.id.channelId:s.id.videoId));if(!n)return null;let g=0;a.type!=="کانال"&&(g=E(n.contentDetails.duration));const d=n.statistics||{},b=a.type==="کانال"?`https://www.youtube.com/channel/${n.id}`:`https://www.youtube.com/watch?v=${n.id}`;return{title:n.snippet.title,description:n.snippet.description,summary:"",url:b,views:p(d.viewCount),likes:p(d.likeCount),comments:p(d.commentCount),publishedAt:_(new Date(n.snippet.publishedAt)),thumbnail:((h=(y=n.snippet.thumbnails)==null?void 0:y.medium)==null?void 0:h.url)||"/fallback-thumbnail.jpg",duration:g}}).filter(s=>s!==null);return a.type==="کوتاه"?l.filter(s=>s.duration<=60):a.type==="بلند"?l.filter(s=>s.duration>60):l}catch(o){return console.error("YouTube API error:",o),[]}};export{M as a,R as b,N as c,k as d,v as e,P as f,$ as g,D as h,K as u,G as y};
